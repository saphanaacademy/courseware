############
# DATAMASK #
############

DROP TABLE "DATAMASKING_INPUT" ;
CREATE COLUMN TABLE "DATAMASKING_INPUT" 
    ("COUNTRY" NVARCHAR(100),
	 "NAME_LINE" NVARCHAR(100),
	 "FIRM" NVARCHAR(100),
	 "POSTCODE" NVARCHAR(100),
	 "PHONE1" NVARCHAR(100),
	 "EMAIL1" NVARCHAR(100),
	 "SSN1" NVARCHAR(100),
	 "CREDIT_CARD" NVARCHAR(100),
	 "DATE1" DATE CS_DAYDATE,
	 "DATE2" DATE CS_DAYDATE,
	 "GENDER" CHAR(1) CS_FIXEDSTRING,
	 "AMOUNT_PURCHASED" DECIMAL(20,8) CS_FIXED,
	 "ORDERID" INT CS_INT,
	 "EMAIL_TEXT" TEXT,
	 "TRACKING_NUMBER_ANUM" ALPHANUM(100) CS_ALPHANUM ) ;
	 
INSERT INTO "DATAMASKING_INPUT" VALUES ('MX','ALLEN GONZALEX','ABC MART','15620','+1 522 853 1844','ALLEN.GONZALEX@UM23.edu','732-45-6543','4O 9A1 387 49 5071 202 7','1985-07-03', '1985-07-03','F',800,23455,'someone@gmail.com','1212A');
INSERT INTO "DATAMASKING_INPUT" VALUES ('IN','DHIRENDRA KUMAR PANDEY','JAGJANANI TEXTILES LIMITED','530017','(721) 039 0617','BANERJEEJ@JYOTHY.COM','224-38-0672','5556 4456 3874 9507','1990-01-03', '1985-07-03','M',500,23455,'PANDEYD@gmail.com','12166A');
INSERT INTO "DATAMASKING_INPUT" VALUES ('CN','彭先锋彭先锋','北京速驰商贸有限公司','100044','1-862-731-7152','彭先@彭先锋彭先锋.cn','024-91-3262','2345 1111 7654 9507','1995-06-06','1985-07-03','M',1000.20,500,'彭先.彭先锋@gmail.com','A1234');
INSERT INTO "DATAMASKING_INPUT" VALUES ('US','FERRY COLLINS','GEEKS FITNESS','67221','982-852-2881','HU76@ZD84.com','663-12-7398','1111 2222 7777 95 06','2000-01-1', '1985-07-03','F',1000.00,600,'HUDA07@gmail.com','S2166');
INSERT INTO "DATAMASKING_INPUT" VALUES ('FR','AMY DES LIGNERIES','SCHMIT SAICA','57100','461-066-6517','DES.LIGNERIES@ONEPLUS.COM','111-62-0666','2222 1111 3874 8507','2005-12-3', '1985-07-03','M',100,125,'laD@gmail.com','12166G');

SELECT * FROM "DATAMASKING_INPUT" ;

1.	Mask Out the NAME_LINE Column everything except first 3 characters using masking character X
	ALLEN GONZALEX  → ALLXX XXXXXXXX

2.	Set pattern variance  on FIRM column 
	a.	1-5 characters to Value A
	b.	6-10 substring  to Values Min:1 to Max :5
	c.	Preserve data from 11- 20 
	d.	Default from 21-100
		JAGJANANI TEXTILES LIMITED  → AAAAA2TEXTILES LLSZEAP

-- Some other examples 

-- 3.	Set Date Variance on Date1  and Date 2 columns
-- a)	Fixed days 5 with Minimum Date set to 07-07-1985 and Max set to 31-12-2001 and 03-07-1986 → 07-07-1985
-- b)	Date Range from 01-01-2015 to 02-06-2016 and 03-07-1985 → 04-09-2015

-- 4.	Mask out all characters with 9 in SSN1 field. 732-45-6543  → 999-99-9999

-- 5.	Numeric variance on AMOUNT_PURCHASED(decimal) column 
-- a)	Variance type percentage of 10 with Min value 500 and Max Value 900 and 800 → 728.39186012

--6.	Numeric variance on ORDERID(integer) column 
-- b)	Variance type Range between 100 - 200 and 23455 → 152

-- 7.	Mask all characters in EMAIL1 column and maintain format 
-- ALLEN.GONZALEX@UM23.edu  → XXXXXXXXXXXXXX@XXXX.XXX

########################
# MATCH SURVIVAL RULES #
########################

CONNECT SYSTEM PASSWORD SHALive1;
GRANT EXECUTE ON "_SYS_REPO"."TEXT_ACCESSOR" TO DEVUSER;
GRANT EXECUTE ON "_SYS_REPO"."MULTI_TEXT_ACCESSOR" TO DEVUSER;

CONNECT DEVUSER PASSWORD SHALive1;
GRANT SELECT, INSERT, UPDATE, DELETE, EXECUTE ON SCHEMA DEVUSER to _SYS_REPO WITH GRANT OPTION;


CREATE COLUMN TABLE "ONLINE_PROSPECTS" ("COUNTRY" NVARCHAR(100),
	 "PERSON" NVARCHAR(100),
	 "TITLE" NVARCHAR(100),
	 "Firm" NVARCHAR(100),
	 "Address1" NVARCHAR(100),
	 "Address2" NVARCHAR(100),
	 "Address3" NVARCHAR(100),
	 "City" NVARCHAR(100),
	 "Region" NVARCHAR(100),
	 "Postcode" NVARCHAR(100),
	 "Email" NVARCHAR(100),
	 "Phone" NVARCHAR(100),
	 "Date" NVARCHAR(100)) UNLOAD PRIORITY 5 AUTO MERGE;

insert into "ONLINE_PROSPECTS" values ('JP','中澤敬尚',null,'清田区　土木センター','平岡二条','4丁目',null,'清田区','北海道','48616',null,null,null);
insert into "ONLINE_PROSPECTS" values ('Japan','中澤敬尚',null,'清田区　土木センター','平岡二条','4丁目',null,'清田区','北海道','48616',null,null,null);
insert into "ONLINE_PROSPECTS" values ('MX','JOSE GARZA DE LA CRUZ',null,'GUAYABERAS MEXICO','CALLE 24 #213 X 37A Y 39','FRAC. MONTE ALBAN',null,'MERIDA','YUCATAN','C.P. 97114',null,'52 999 9279442','14-04-2000');
insert into "ONLINE_PROSPECTS" values ('MX','JOSE GARZA DE LA CRUZ',null,'GUAYABERAS MEXICO','CALLE 24 #213 X 37A Y 39','FRAC. MONTE ALBAN',null,'MERIDA','YUCATAN','C.P. 97114',null,'52 999 9279442','14-04-2006');
insert into "ONLINE_PROSPECTS" values ('IN','SURENDRA KUMAR SANTRAM SAHNI',null,'VALECHA ENGINEERING LIMITED','VALECHA CHAMBERS','7TH FLOOR NEW LINK ROAD',null,'MUMBAI',null,'400 053','SURENDRA.SAHNI@VALECHA.IN','022 26733645','14-04-2000');
insert into "ONLINE_PROSPECTS" values ('IN','SURENDRA KUMAR SANTRAM SAHNI',null,'VALECHA ENGINEERING LIMITED','VALECHA CHAMBERS','7TH FLOOR NEW LINK ROAD',null,'MUMBAI',null,'400 053','SURENDRA.SAHNI@VALECHA.IN','91 022 26733645','14-04-2000');

-- new rules; can change order
-- oldest date
-- longest country
-- shortest phone number

-- run this as LIVE4 user to create the PRODUCT_INVENTORY view
-- the view shows the current inventory of every product for each store

DROP VIEW LIVE4.PRODUCT_INVENTORY;

CREATE VIEW LIVE4.PRODUCT_INVENTORY AS
SELECT
	 ROW_NUMBER() OVER (ORDER BY MANDT, WERKS, MATNR) AS ROW_NUM,
	 CAST(MANDT AS VARCHAR) AS MANDT,
	 CAST(WERKS AS VARCHAR) AS WERKS,
	 CAST(MATNR AS VARCHAR) AS MATNR,
	 CAST(SUM(LABST + UMLME + INSME + EINME + SPEME + RETME) AS INTEGER) AS INVENTORY,
	 MAX(TO_DATE(ERSDA, 'YYYYMMDD')) AS INVENTORY_DATE 
FROM LIVE4.MARD 
GROUP BY MANDT, MATNR, WERKS 
WITH READ ONLY;

SELECT * FROM LIVE4.PRODUCT_INVENTORY;
